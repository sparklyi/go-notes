# RabbitMQ笔记

## 工作模式

### 1. work queues(工作队列)

**工作流程**

 生产者->队列->消费者(允许多个)

**消息确认**

手动设置消费者的ack，保证消息不丢失，其中一个消费者挂掉后消息重新排队等待其他消费者处理， 当worker未回传ack信息时或长时间未回传则重排，交付给其他worker

手动需要完成回传ack，否则会导致消息堆积



**公平**

调度默认以公平原则进行，比如4个任务会把1、3分配给第一个，2、4分配给第2个，当1、3处理时间很长时导致另一个worker浪费，通过设置$$fetchCount=1$$，为每个work指定最大分配数，一般为1，即谁先完成谁继续处理，而不是累计起来慢慢处理



**持久化**

当消息队列缓存到本地，防止RabbitMQ挂掉后丢失队列和消息，设置队列的$$durable=true$$保证队列持久化存储，设置消息传送模式为$$amqp.Presistent$$保证持久化

